document.getElementById('hadirkan-semua-btn').addEventListener('click', async () => {
    const today = new Date().toISOString().split('T')[0];
    const filterKelas = document.getElementById('filter-kelas-kehadiran').value;
    
    // Tampilkan tanggal kehadiran
    const tanggalElement = document.getElementById('tanggal-kehadiran');
    if (tanggalElement) {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        tanggalElement.textContent = new Date().toLocaleDateString('id-ID', options);
    }
    
    showLoading();
    try {
        // Get all students
        let siswaQuery = supabaseClient.from('siswa').select('*');
        if (filterKelas) {
            siswaQuery = siswaQuery.eq('kelas', filterKelas);
        }
        
        const { data: siswa, error: siswaError } = await siswaQuery;
        if (siswaError) throw siswaError;
        
        // Mark all as present
        for (const s of siswa) {
            // Check if attendance record exists
            const { data: existingKehadiran } = await supabaseClient
                .from('kehadiran')
                .select('*')
                .eq('siswa_id', s.id)
                .eq('tanggal', today)
                .single();
            
            if (existingKehadiran) {
                // Update existing record
                await supabaseClient
                    .from('kehadiran')
                    .update({ status: 'hadir' })
                    .eq('id', existingKehadiran.id);
            } else {
                // Insert new record
                await supabaseClient
                    .from('kehadiran')
                    .insert([{
                        siswa_id: s.id,
                        tanggal: today,
                        status: 'hadir'
                    }]);
            }
        }
        
        await loadKehadiranContent();
        alert('Semua siswa telah dihadirkan!');
    } catch (error) {
        console.error('Error marking all present:', error);
        alert('Gagal menghadirkan semua siswa: ' + error.message);
    } finally {
        hideLoading();
    }
